const c=document.querySelector("#peliculas"),i=document.querySelector("#contenido"),d="/api/select_salas",u="/api/select_sala_id/",h="/api/reservar_asiento/";fetch(d).then(r=>{if(!r.ok)throw new Error("Error en la API: "+r.status);return r.json()}).then(r=>{const t=r.salas;m(t)}).catch(r=>{console.error("Error al obtener las películas:",r)});function m(r){c.innerHTML="",r.forEach(t=>{const e=document.createElement("button");e.textContent=t.pelicula,e.dataset.id=t.id,e.innerHTML=`
        <div class="relative group">
          <img src="${t.enlaceImg}" alt="${t.pelicula}" class="rounded-md object-cover w-full h-auto transition duration-300 transform group-hover:grayscale group-hover:opacity-80" crossorigin="anonymous">

          <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <span class="text-white text-lg font-bold p-4 bg-gray-800 rounded-md">Entradas</span>
          </div>
        </div>
      `,e.addEventListener("click",()=>{f(t.id),E(t.id)}),c.appendChild(e)})}function f(r){c.style.display="none",i.innerHTML=`<div class="mb-4"><button id="atras" class="flex justify-center items-center ml-4 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Atrás</button><h2 class="flex justify-center items-center text-xl  font-semibold">Asientos Disponibles en la sala ${r}</h2> </div>`,document.getElementById("atras").addEventListener("click",()=>{v()}),fetch(`${u}${r}`).then(e=>{if(!e.ok)throw new Error("Error al obtener los asientos: "+e.status);return e.json()}).then(e=>{const s=e.asientos;g(s)}).catch(e=>{console.error("Error al obtener los asientos: "+e),i.innerHTML="Error al obtener los asientos. Inténtelo de nuevo más tarde"})}let a=[];function g(r){const t=document.createElement("div");t.classList.add("grid","grid-cols-10","gap-2","w-full","max-w-xl","mx-auto","mb-6"),r.forEach(s=>{const n=document.createElement("div");if(n.classList.add("flex","items-center","justify-center","h-12","w-12","cursor-pointer"),s.reservado===0){n.classList.add("bg-green-500","hover:bg-green-600");const o=document.createElement("img");o.src="asiento-libre.png",o.alt="Asiento libre",o.classList.add("h-full","w-full","object-contain"),n.appendChild(o),n.addEventListener("click",()=>{a.includes(s.id)?(n.classList.remove("bg-orange-500"),a=a.filter(p=>p!==s.id)):(n.classList.add("bg-orange-500"),a.push(s.id))})}else{n.classList.add("bg-gray-500","cursor-not-allowed");const o=document.createElement("img");o.src="asiento-ocupado.png",o.alt="Asiento ocupado",o.classList.add("h-full","w-full","object-contain"),n.appendChild(o)}t.appendChild(n)}),i.appendChild(t);const e=document.createElement("button");e.textContent="Reservar",e.classList.add("flex","items-center","justify-center","m-6","px-4","py-2","bg-blue-500","text-white","rounded-md","hover:bg-blue-600","mx-auto"),i.appendChild(e),e.addEventListener("click",()=>{a.length>0?b(a):l("Por favor, seleccione al menos un asiento.","error")})}function b(r){if(r.length===0){l("Por favor, seleccione al menos un asiento.","error");return}r.forEach(t=>{fetch(`${h}${t}`).then(e=>{if(!e.ok)throw new Error("No se pudo reservar el asiento.");return e.json()}).then(e=>{e.message==="Asiento actualizado con éxito"?l("Asiento reservado exitosamente","success"):l("No ha sido posible reservar el asiento","error")}).catch(e=>{console.error("Error al intentar reservar el asiento:",e),l("Error al intentar reservar el asiento","error")})})}function l(r,t){const e=document.createElement("div");e.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),t==="success"?e.classList.add("bg-green-500"):t==="error"&&e.classList.add("bg-red-500"),e.textContent=r,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function v(){c.style.display="grid",document.getElementById("info-pelicula").classList.add("hidden"),i.innerHTML="",fetch(d).then(t=>t.json()).then(t=>{m(t.salas)}).catch(t=>{console.error("Error al obtener las películas:",t)})}function E(r){fetch(`${u}${r}`).then(t=>{if(!t.ok)throw new Error("Error al obtener los detalles de la sala: "+t.status);return t.json()}).then(t=>{const e=t.sala[0],s=document.getElementById("info-pelicula"),n=document.getElementById("detalle-pelicula");n.innerHTML="",n.innerHTML=`
                <h2 class="text-2xl font-bold mb-4">${e.pelicula}</h2>
                <img src="${e.enlaceImg}" alt="${e.pelicula}" class="rounded-md mb-4">
                <p class="mb-4"><strong>Sinopsis:</strong> ${e.sinopsis}</p>
            `,s.classList.remove("hidden")}).catch(t=>{console.error("Error al obtener las películas:",t),l("No se pudieron cargar las películas","error")})}
