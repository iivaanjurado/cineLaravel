document.addEventListener("DOMContentLoaded",()=>{const a="/api/select_salas",t="/api/delete_sala_id";let e=null;function n(){fetch(a).then(o=>o.json()).then(o=>{let s=document.querySelector("#movie");s.innerHTML='<option value="" disabled selected>Elige una película</option>',o.salas.forEach(d=>{const g=document.createElement("option");g.value=d.id,g.textContent=d.pelicula,s.appendChild(g)})}).catch(o=>{console.error("Error al cargar las películas:",o),h("Error al cargar las películas.","error")})}function r(o){e=o.target.value}function l(){if(!e){h("No se ha seleccionado ninguna película, por favor selecciona una.","error");return}confirm(`¿Estás seguro de que deseas eliminar la película con ID: ${e}?`)&&fetch(t+"/"+e).then(s=>s.json()).then(s=>{s.message?(h("Se ha eliminado la película correctamente","success"),n()):h("Hubo un error al eliminar la película.","error")}).catch(s=>{console.error("Error al eliminar la película:",s),h("Hubo un error al eliminar la película.","error")})}n(),document.getElementById("movie").addEventListener("change",r),document.getElementById("formulario-eliminar").addEventListener("submit",o=>{o.preventDefault(),l()})});function h(a,t){const e=document.createElement("div");e.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),t==="success"?e.classList.add("bg-green-500"):t==="error"?e.classList.add("bg-red-500"):e.classList.add("bg-gray-500"),e.textContent=a,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}const w="/api/insert_sala";document.addEventListener("DOMContentLoaded",function(){document.querySelector("form").addEventListener("submit",function(t){t.preventDefault();const e=document.getElementById("titulo").value,n=document.getElementById("enlace").value,r=document.getElementById("sinopsis").value;if(!e||!n||!r){b("Por favor, complete todos los campos.","error");return}const l=`${w}?titulo=${encodeURIComponent(e)}&enlace=${encodeURIComponent(n)}&sinopsis=${encodeURIComponent(r)}`;fetch(l,{method:"GET"}).then(i=>i.json()).then(i=>{i.message==="Sala creada con éxito"?b("Sala insertada exitosamente.","success"):b("Error al insertar la sala: "+(i.message||"Inténtelo de nuevo más tarde"),"error")}).catch(i=>{console.error("Error en la solicitud:",i),b("Hubo un problema al intentar insertar la sala.","error")})})});function b(a,t){const e=document.createElement("div");e.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),t==="success"?e.classList.add("bg-green-500"):t==="error"?e.classList.add("bg-red-500"):e.classList.add("bg-gray-500"),e.textContent=a,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}document.addEventListener("DOMContentLoaded",()=>{const a="/api/select_salas",t="/api/update_sala";let e,n=null;function r(){fetch(a).then(c=>{if(!c.ok)throw new Error("Error al obtener las películas: "+c.status);return c.json()}).then(c=>{console.log(c);let o=document.querySelector("#movie");for(;o.options.length>1;)o.remove(1);o.remove(1),c.salas.forEach(s=>{const d=document.createElement("option");d.value=s.id,d.textContent=s.pelicula,o.appendChild(d)})}).catch(c=>{console.error("Error al cargar las películas:",c)})}function l(c){if(e=c.target.value,!e){m("Por favor seleccione una película.","error");return}fetch(a).then(o=>o.json()).then(o=>{n=o.salas.find(s=>s.id==e),n?(document.getElementById("titulo").value=n.pelicula,document.getElementById("sinopsis").value=n.sinopsis,document.getElementById("enlace").value=n.enlaceImg,m("Detalles de la película cargados.","success")):m("No se encontró información para la película seleccionada.","error")}).catch(o=>{console.error("Error al cargar los detalles de la película:",o),m("Hubo un problema al cargar los detalles de la película.","error")})}function i(c){if(c.preventDefault(),!n){m("No se ha seleccionado ninguna película","error");return}let o=document.getElementById("titulo").value,s=document.getElementById("sinopsis").value,d=document.getElementById("enlace").value;const g={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id,titulo:o,sinopsis:s,enlace:d})};fetch(t,g).then(u=>u.json()).then(u=>{if(u.errors)throw new Error("Error al actualizar la sala: "+u.status);console.log(u),m("Sala actualizada correctamente.","success"),r()}).catch(u=>{console.error("Error al actualizar la sala:",u),m("Ha ocurrido un problema al actualizar la sala.","Error")})}window.onload=function(){r(),document.getElementById("movie").addEventListener("change",l),document.getElementById("formulario-sala").addEventListener("submit",i)}});function m(a,t){const e=document.createElement("div");e.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),t==="success"?e.classList.add("bg-green-500"):t==="error"?e.classList.add("bg-red-500"):e.classList.add("bg-gray-500"),e.textContent=a,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}const E=document.querySelector("#peliculas"),v=document.querySelector("#contenido"),y="/api/select_salas",x="/api/select_sala_id/",I="api/reservar_asiento/";fetch(y).then(a=>{if(!a.ok)throw new Error("Error en la API: "+a.status);return a.json()}).then(a=>{const t=a.salas;L(t)}).catch(a=>{console.error("Error al obtener las películas:",a)});function L(a){E.innerHTML="",a.forEach(t=>{const e=document.createElement("button");e.textContent=t.pelicula,e.dataset.id=t.id,e.innerHTML=`
        <div class="relative group">
          <img src="${t.enlaceImg}" alt="${t.pelicula}" class="rounded-md object-cover w-full h-auto transition duration-300 transform group-hover:grayscale group-hover:opacity-80" crossorigin="anonymous">

          <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <span class="text-white text-lg font-bold p-4 bg-gray-800 rounded-md">Entradas</span>
          </div>
        </div>
      `,e.addEventListener("click",()=>{C(t.id),j(t.id)}),E.appendChild(e)})}function C(a){E.style.display="none",v.innerHTML=`<div class="mb-4"><button id="atras" class="flex justify-center items-center ml-4 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Atrás</button><h2 class="flex justify-center items-center text-xl  font-semibold">Asientos Disponibles en la sala ${a}</h2> </div>`,document.getElementById("atras").addEventListener("click",()=>{$()}),fetch(`${x}${a}`).then(e=>{if(!e.ok)throw new Error("Error al obtener los asientos: "+e.status);return e.json()}).then(e=>{const n=e.asientos;P(n)}).catch(e=>{console.error("Error al obtener los asientos: "+e),v.innerHTML="Error al obtener los asientos. Inténtelo de nuevo más tarde"})}let p=[];function P(a){const t=document.createElement("div");t.classList.add("grid","grid-cols-10","gap-2","w-full","max-w-xl","mx-auto","mb-6"),a.forEach(n=>{const r=document.createElement("div");if(r.classList.add("flex","items-center","justify-center","h-12","w-12","cursor-pointer"),n.reservado===0){r.classList.add("bg-green-500","hover:bg-green-600");const l=document.createElement("img");l.src="asiento-libre.png",l.alt="Asiento libre",l.classList.add("h-full","w-full","object-contain"),r.appendChild(l),r.addEventListener("click",()=>{p.includes(n.id)?(r.classList.remove("bg-orange-500"),p=p.filter(i=>i!==n.id)):(r.classList.add("bg-orange-500"),p.push(n.id))})}else{r.classList.add("bg-gray-500","cursor-not-allowed");const l=document.createElement("img");l.src="asiento-ocupado.png",l.alt="Asiento ocupado",l.classList.add("h-full","w-full","object-contain"),r.appendChild(l)}t.appendChild(r)}),v.appendChild(t);const e=document.createElement("button");e.textContent="Reservar",e.classList.add("flex","items-center","justify-center","m-6","px-4","py-2","bg-blue-500","text-white","rounded-md","hover:bg-blue-600","mx-auto"),v.appendChild(e),e.addEventListener("click",()=>{p.length>0?S(p):f("Por favor, seleccione al menos un asiento.","error")})}function S(a){if(a.length===0){f("Por favor, seleccione al menos un asiento.","error");return}a.forEach(t=>{fetch(`${I}${t}`).then(e=>{if(!e.ok)throw new Error("No se pudo reservar el asiento.");return e.json()}).then(e=>{e.message==="Asiento actualizado con éxito"?f("Asiento reservado exitosamente","success"):f("No ha sido posible reservar el asiento","error")}).catch(e=>{console.error("Error al intentar reservar el asiento:",e),f("Error al intentar reservar el asiento","error")})})}function f(a,t){const e=document.createElement("div");e.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),t==="success"?e.classList.add("bg-green-500"):t==="error"&&e.classList.add("bg-red-500"),e.textContent=a,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function $(){E.style.display="grid",document.getElementById("info-pelicula").classList.add("hidden"),v.innerHTML="",fetch(y).then(t=>t.json()).then(t=>{L(t.salas)}).catch(t=>{console.error("Error al obtener las películas:",t)})}function j(a){fetch(`${x}${a}`).then(t=>{if(!t.ok)throw new Error("Error al obtener los detalles de la sala: "+t.status);return t.json()}).then(t=>{const e=t.sala[0],n=document.getElementById("info-pelicula"),r=document.getElementById("detalle-pelicula");r.innerHTML="",r.innerHTML=`
                <h2 class="text-2xl font-bold mb-4">${e.pelicula}</h2>
                <img src="${e.enlaceImg}" alt="${e.pelicula}" class="rounded-md mb-4">
                <p class="mb-4"><strong>Sinopsis:</strong> ${e.sinopsis}</p>
            `,n.classList.remove("hidden")}).catch(t=>{console.error("Error al obtener los detalles de la película:",t),f("Error al obtener los detalles de la película","error")})}
