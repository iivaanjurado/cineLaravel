document.addEventListener("DOMContentLoaded",()=>{const s="/api/select_salas",i="/api/update_sala";let t,l=null;function u(){fetch(s).then(e=>{if(!e.ok)throw new Error("Error al obtener las películas: "+e.status);return e.json()}).then(e=>{console.log(e);let a=document.querySelector("#movie");for(;a.options.length>1;)a.remove(1);a.remove(1),e.salas.forEach(r=>{const c=document.createElement("option");c.value=r.id,c.textContent=r.pelicula,a.appendChild(c)})}).catch(e=>{console.error("Error al cargar las películas:",e)})}function d(e){if(t=e.target.value,!t){n("Por favor seleccione una película.","error");return}fetch(s).then(a=>a.json()).then(a=>{l=a.salas.find(r=>r.id==t),l?(document.getElementById("titulo").value=l.pelicula,document.getElementById("sinopsis").value=l.sinopsis,document.getElementById("enlace").value=l.enlaceImg,n("Detalles de la película cargados.","success")):n("No se encontró información para la película seleccionada.","error")}).catch(a=>{console.error("Error al cargar los detalles de la película:",a),n("Hubo un problema al cargar los detalles de la película.","error")})}function m(e){if(e.preventDefault(),!l){n("No se ha seleccionado ninguna película","error");return}let a=document.getElementById("titulo").value,r=document.getElementById("sinopsis").value,c=document.getElementById("enlace").value;const p={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:l.id,titulo:a,sinopsis:r,enlace:c})};fetch(i,p).then(o=>o.json()).then(o=>{if(o.errors)throw new Error("Error al actualizar la sala: "+o.status);console.log(o),n("Sala actualizada correctamente.","success"),u()}).catch(o=>{console.error("Error al actualizar la sala:",o),n("Ha ocurrido un problema al actualizar la sala.","Error")})}window.onload=function(){u(),document.getElementById("movie").addEventListener("change",d),document.getElementById("formulario-sala").addEventListener("submit",m)}});function n(s,i){const t=document.createElement("div");t.classList.add("fixed","bottom-5","left-1/2","transform","-translate-x-1/2","px-6","py-3","rounded-lg","text-white","shadow-lg","w-72","text-center"),i==="success"?t.classList.add("bg-green-500"):i==="error"?t.classList.add("bg-red-500"):t.classList.add("bg-gray-500"),t.textContent=s,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}
